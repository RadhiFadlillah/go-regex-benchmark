# Go Regex Benchmark

This repo is a benchmark for various Golang's regular expressions library. Based on benchmark by Rustem Kamalov [here](https://github.com/karust/regex-benchmark).

Unlike the original repository, here I only focus on Go language without caring about its performance compared to the other languages.

## Input Text

Like the original, the [input text](./input-text.txt) is a concatenation of [Learn X in Y minutes](https://github.com/adambard/learnxinyminutes-docs) repository.

## Regex Patterns

Like the original, the used patterns are:

- Email: `[\w\.+-]+@[\w\.-]+\.[\w\.-]+`
- URI: `[\w]+://[^/\s?#]+[^\s?#]+(?:\?[^\s#]*)?(?:#[^\s]*)?`
- IPv4: `(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9])`

## Measure

Unlike the original, measuring is done without including regex compilation. So the measurement only focused on pattern matching.

## Used Packages

There are 8 regular expression packages that used in this benchmark:

- **Go**: the `regexp` package from Go's standard library.
- **Grafana**: the package from `github.com/grafana/regexp` by Bryan Boreham that improve the standard library with several optimations. Actively maintained at the time this benchmark is written.
- **Modernc**: the package from `modernc.org/regexp` that implements experimental DFA support.
- **Regexp2**: the package from `github.com/dlclark/regexp2` that ports regex engine from .NET frameworks.
- **RE2**: the package from `github.com/wasilibs/go-re2` that binds `google/re2` regex engine using WebAssembly or cgo.
- **Hyperscan**: the package from `github.com/flier/gohs` that binds Intel's `hyperscan` regex engine using cgo.
- **PCRE**: the package from `github.com/GRbit/go-pcre` that binds PCRE regex engine using cgo.
- **re2go**: unlike the others, this one use `re2go` to compile regular expressions into Go code. It uses TDFA algorithm.

## Result

The benchmark was run on Linux with Intel i7-8550U with RAM 16 GB.

|  Package  | Use CGO | Email (ms) | URI (ms) | IP (ms) | Total (ms) |  Times |
| :-------: | :-----: | ---------: | -------: | ------: | ---------: | -----: |
|  RE2 CGO  |   Yes   |       9.57 |    12.45 |    9.83 |      31.85 | 28.52x |
| Hyperscan |   Yes   |      27.97 |    26.67 |    0.81 |      55.45 | 16.38x |
|   PCRE    |   Yes   |      24.45 |    25.59 |    9.27 |      59.31 | 15.31x |
|   re2go   |         |      55.61 |    37.75 |   11.61 |     104.97 |  8.65x |
| RE2 WASM  |         |      52.76 |    61.75 |   52.26 |     166.77 |  5.45x |
|  Go std   |         |     253.57 |   249.59 |  405.07 |     908.23 |  1.00x |
|  Modernc  |         |     263.62 |   258.68 |  404.32 |     926.62 |  0.98x |
|  Grafana  |         |     288.79 |   263.49 |  421.97 |     974.25 |  0.93x |
|  Regexp2  |         |    2600.82 |  2446.62 |   80.68 |    5128.11 |  0.18x |

- Re2 with cgo is the fastest, while Regexp2 is the slowest.
- Regex engines that binded with cgo are way faster than the ones without cgo.
- Code generated by re2go is the fastest for implementation that doesn't use cgo. Unfortunately, some Go's regex syntaxes are not supported by re2go, so there are slight modifications to the regex patterns.
- Re2 with WebAssembly is the fastest regex engine that doesn't use cgo, but with full compatibility with Go's regex syntaxes.
- Regex engine by Modernc that implements DFA is actually a bit slower than the engine from standard library.
